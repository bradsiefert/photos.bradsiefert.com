<template>
  <div class="portfolio">
    <section class="slider" aria-label="Instant film photo carousel">
      <div class="flexslider loading" role="region" aria-roledescription="carousel" aria-label="Instant film photos">
        <ul class="slides" aria-live="polite">
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-2019-wolfpack-retreat.jpg" alt="SX-70 portraits of my friends at our annual retreat" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-nicole.jpg" alt="SX-70 portraits of Nicole" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-goyita.jpg" alt="Studio portraits of Goyita shot on FB-100C and FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-tony-and-jimmy.jpg" alt="Studio portraits of Tony Campolo and Jimmy Spencer Jr. shot on FB-100C film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-the83rd1.jpg" alt="Studio portraits of Will shot on FB-100C and FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-the83rd2.jpg" alt="Will portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-nathanael1.jpg" alt="Nathanael Filbert shot on expired Polaroid 661 film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-rabbitisland.jpg" alt="Surfing at Rabbit Island shot on FB-100C film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-logansquare.jpg" alt="Logan Square polardoids" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-josh2.jpg" alt="Josh Stunkel double exposure portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-jason.jpg" alt="Jason Gerber double exposure portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-nathanael2.jpg" alt="Nathanael Filbert double exposure portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-mike.jpg" alt="Mike Mirza portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-josh1.jpg" alt="Josh Stunkel double exposure portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-ab.jpg" alt="Anthony Barlich double exposure portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-truman.jpg" alt="Josh Truman portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-woods.jpg" alt="Woods shot in black and white FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-lawrence.jpg" alt="Lawrence Agyei portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-shiraz.jpg" alt="Shirz at a party portrait shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-thewomb.jpg" alt="The Womb dance party shot on FB-3000b film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-nicole-wedding.jpg" alt="Nicole wedding dance on Instax Wide Film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-2018holidayparty.jpg" alt="2018 holiday party polaroids shot on Polaroid 600 film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-sawyermichigan.jpg" alt="Keep Sawywer, MI Weird shot on Instax Wide Film" /></li>
          <li><NuxtImg src="/portfolio/instant-film/instantfilm-selfportrait.jpg" alt="Brad Siefert self portrait shot on FB-100C" /></li>
        </ul>
      </div>
    </section>
  </div><!-- /portfolio -->

  <!-- /portfolio-mobile -->
  <div class="container-fluid portfolio-mobile">
    <div class="row">
      <ul class="list-unstyled">
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-2019-wolfpack-retreat.jpg" alt="SX-70 portraits of my friends at our annual retreat" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-nicole.jpg" alt="SX-70 portraits of Nicole" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-goyita.jpg" alt="Studio portraits of Goyita shot on FB-100C and FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-tony-and-jimmy.jpg" alt="Studio portraits of Tony Campolo and Jimmy Spencer Jr. shot on FB-100C film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-the83rd1.jpg" alt="Studio portraits of Will shot on FB-100C and FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-the83rd2.jpg" alt="Will portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-nathanael1.jpg" alt="Nathanael Filbert shot on expired Polaroid 661 film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-rabbitisland.jpg" alt="Surfing at Rabbit Island shot on FB-100C film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-logansquare.jpg" alt="Logan Square polardoids" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-josh2.jpg" alt="Josh Stunkel double exposure portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-jason.jpg" alt="Jason Gerber double exposure portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-nathanael2.jpg" alt="Nathanael Filbert double exposure portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-mike.jpg" alt="Mike Mirza portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-josh1.jpg" alt="Josh Stunkel double exposure portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-ab.jpg" alt="Anthony Barlich double exposure portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-truman.jpg" alt="Josh Truman portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-wolfpackretreat-woods.jpg" alt="Woods shot in black and white FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-lawrence.jpg" alt="Lawrence Agyei portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-shiraz.jpg" alt="Shirz at a party portrait shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-thewomb.jpg" alt="The Womb dance party shot on FB-3000b film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-nicole-wedding.jpg" alt="Nicole wedding dance on Instax Wide Film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-2018holidayparty.jpg" alt="2018 holiday party polaroids shot on Polaroid 600 film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-sawyermichigan.jpg" alt="Keep Sawywer, MI Weird shot on Instax Wide Film" /></li>
        <li><NuxtImg src="/portfolio/instant-film/instantfilm-selfportrait.jpg" alt="Brad Siefert self portrait shot on FB-100C" /></li>
      </ul>
    </div>
  </div>
  <!-- /portfolio-mobile -->
</template>

<script>
export default {
  mounted() {
    function updateAriaHidden(slider) {
      const slides = slider.find('.slides > li');
      const currentIndex = slider.currentSlide || 0;
      slides.each(function(index) {
        const slide = $(this);
        if (index === currentIndex) {
          slide.attr('aria-hidden', 'false');
        } else {
          slide.attr('aria-hidden', 'true');
        }
      });
    }

    // Wait for all images in the slider to load before initializing
    const flexslider = $('.flexslider');
    const images = flexslider.find('img');
    
    // Create promises for all image loads
    const imageLoadPromises = Array.from(images).map(img => {
      return new Promise((resolve) => {
        if (img.complete && img.naturalHeight !== 0) {
          // Image already loaded
          resolve();
        } else {
          img.addEventListener('load', resolve, { once: true });
          img.addEventListener('error', resolve, { once: true }); // Resolve even on error to not block
        }
      });
    });

    // Wait for all images to load, then initialize FlexSlider
    Promise.all(imageLoadPromises).then(() => {
      const slider = flexslider.flexslider({
        animation: "slide",
        start: function(slider) {
          slider.removeClass('loading');
          // Set initial aria-hidden states
          updateAriaHidden(slider);
        },
        after: function(slider) {
          // Update aria-hidden when slide changes
          updateAriaHidden(slider);
        }
      });
    });
  }
}
</script>